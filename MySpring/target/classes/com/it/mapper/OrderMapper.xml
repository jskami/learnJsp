<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.it.mapper.OrderMapper">
	
	<insert id="insertmain">
		insert into tblordermain (m_id)
		values (#{m_id})
	</insert>
	<select id="readmainid" resultType="com.it.domain.OrdermainVO"> <!-- 사용자id(세션)물고 오기 위해 추가 -->
		select * from tblordermain where m_id = #{m_id} order by om_code desc limit 1 <!-- 하나만 인출해야 하기 때문에 limit 사용 -->
	</select>
	<insert id="insertsub">
		insert into tblordersub (om_code, p_code, os_cnt)
		values (#{om_code}, #{p_code}, #{os_cnt})
	</insert>
	
	<select id="getListOrderDetail" resultType="com.it.domain.OrderdetailDTO">
		select os.os_code, p.p_code, p.p_name, p.p_price, os.os_cnt, p.p_price*os.os_cnt os_money
		from tblproduct p, tblordersub os
		where p.p_code = os.p_code
		and os.om_code = #{om_code}
	</select>
	
	<select id="getOrderTotal" resultType="com.it.domain.OrdermemberDTO"> <!-- 특정 사용자의 장바구니 총 금액 -->
		select sum(p.p_price * os.os_cnt) om_total
		from tblproduct p, tblordersub os
		where p.p_code = os.p_code
		and os.om_code = #{om_code}		
	</select>
	
</mapper>